// ===== Language Translations =====
const translations = {
    en: {
        hero: {
            title: "CleanDino",
            subtitle: "Quality Apps for Everyone"
        },
        raku: {
            name: "Raku JLPT Vocabulary",
            tagline: "Master JLPT with Smart Learning",
            description: "Struggling with JLPT vocabulary? Master N5-N1 with smart review and proven results. Your pocket JLPT tutor.",
            feature1: "ðŸ“š Complete N5-N1 vocabulary with systematic learning paths",
            feature2: "ðŸŽ¯ Smart review with auto-generated wrong answer notes",
            feature3: "ðŸ“± Home screen widgets for learning without opening app",
            feature4: "âš¡ Speed mode for rapid practice and exam preparation",
            feature5: "ðŸ“– Example sentences for contextual learning"
        },
        age: {
            name: "Age Calculator",
            tagline: "Precise Age Calculation at Your Fingertips",
            description: "Confused about Korean age vs international age? Calculate instantly with birthday tracking and zodiac insights.",
            feature1: "ðŸŽ¯ Multiple age formats: International, Korean, and Year age",
            feature2: "ðŸ“Š Detailed life statistics: days, weeks, months, hours, seconds",
            feature3: "ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦ Birthday manager for family and friends",
            feature4: "â­ Automatic zodiac sign detection with detailed info",
            feature5: "ðŸ”® Daily horoscope based on your zodiac sign"
        },
        features: {
            title: "Key Features"
        },
        download: {
            android: "Google Play",
            ios: "App Store"
        }
    },
    ja: {
        hero: {
            title: "CleanDino",
            subtitle: "ã¿ã‚“ãªã®ãŸã‚ã®é«˜å“è³ªã‚¢ãƒ—ãƒª"
        },
        raku: {
            name: "Raku JLPT å˜èªžå¸³",
            tagline: "ã‚¹ãƒžãƒ¼ãƒˆå­¦ç¿’ã§JLPTã‚’ãƒžã‚¹ã‚¿ãƒ¼",
            description: "JLPTå˜èªžå­¦ç¿’ã«æ‚©ã‚“ã§ã„ã¾ã™ã‹ï¼Ÿã‚¹ãƒžãƒ¼ãƒˆå¾©ç¿’ã¨ç¢ºå®Ÿãªæš—è¨˜ã§N5-N1ã‚’ãƒžã‚¹ã‚¿ãƒ¼ã€‚ã‚ãªãŸã®ãƒã‚±ãƒƒãƒˆJLPTè¬›å¸«ã€‚",
            feature1: "ðŸ“š N5-N1ã®å…¨å˜èªžã‚’ä½“ç³»çš„ãªå­¦ç¿’ãƒ‘ã‚¹ã§æä¾›",
            feature2: "ðŸŽ¯ è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹é–“é•ã„ãƒŽãƒ¼ãƒˆã§ã‚¹ãƒžãƒ¼ãƒˆå¾©ç¿’",
            feature3: "ðŸ“± ã‚¢ãƒ—ãƒªã‚’é–‹ã‹ãšã«å­¦ç¿’ã§ãã‚‹ãƒ›ãƒ¼ãƒ ç”»é¢ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ",
            feature4: "âš¡ è©¦é¨“å¯¾ç­–ã®ãŸã‚ã®é«˜é€Ÿç·´ç¿’ãƒ¢ãƒ¼ãƒ‰",
            feature5: "ðŸ“– æ–‡è„ˆã§å­¦ã¹ã‚‹ä¾‹æ–‡æ©Ÿèƒ½"
        },
        age: {
            name: "å¹´é½¢è¨ˆç®—æ©Ÿ",
            tagline: "æŒ‡å…ˆã§æ­£ç¢ºãªå¹´é½¢è¨ˆç®—",
            description: "éŸ“å›½å¹´é½¢ã¨æº€å¹´é½¢ã®é•ã„ã«æ‚©ã‚“ã§ã„ã¾ã™ã‹ï¼Ÿèª•ç”Ÿæ—¥è¿½è·¡ã¨æ˜Ÿåº§æƒ…å ±ã§å³åº§ã«è¨ˆç®—ã€‚",
            feature1: "ðŸŽ¯ è¤‡æ•°ã®å¹´é½¢å½¢å¼ï¼šæº€å¹´é½¢ã€éŸ“å›½å¹´é½¢ã€æ•°ãˆå¹´",
            feature2: "ðŸ“Š è©³ç´°ãªäººç”Ÿçµ±è¨ˆï¼šæ—¥æ•°ã€é€±ã€æœˆã€æ™‚é–“ã€ç§’",
            feature3: "ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦ å®¶æ—ã‚„å‹äººã®èª•ç”Ÿæ—¥ç®¡ç†",
            feature4: "â­ è©³ç´°æƒ…å ±ä»˜ãæ˜Ÿåº§è‡ªå‹•åˆ¤å®š",
            feature5: "ðŸ”® æ˜Ÿåº§ã«åŸºã¥ãæ¯Žæ—¥ã®å ã„"
        },
        features: {
            title: "ä¸»ãªæ©Ÿèƒ½"
        },
        download: {
            android: "Google Play",
            ios: "App Store"
        }
    },
    ko: {
        hero: {
            title: "CleanDino",
            subtitle: "ëª¨ë‘ë¥¼ ìœ„í•œ ê³ í’ˆì§ˆ ì•±"
        },
        raku: {
            name: "Raku JLPT ë‹¨ì–´ìž¥",
            tagline: "ìŠ¤ë§ˆíŠ¸ í•™ìŠµìœ¼ë¡œ JLPT ë§ˆìŠ¤í„°",
            description: "JLPT ë‹¨ì–´ ì•”ê¸°ê°€ ì–´ë ¤ìš°ì‹ ê°€ìš”? ìŠ¤ë§ˆíŠ¸ ë³µìŠµê³¼ í™•ì‹¤í•œ ì•”ê¸°ë¡œ N5-N1 ë§ˆìŠ¤í„°. ì£¼ë¨¸ë‹ˆ ì† JLPT ê³¼ì™¸ ì„ ìƒë‹˜.",
            feature1: "ðŸ“š ì²´ê³„ì ì¸ í•™ìŠµ ê²½ë¡œë¡œ ì œê³µë˜ëŠ” N5-N1 ì „ì²´ ë‹¨ì–´",
            feature2: "ðŸŽ¯ ìžë™ ìƒì„± ì˜¤ë‹µë…¸íŠ¸ë¡œ ìŠ¤ë§ˆíŠ¸ ë³µìŠµ",
            feature3: "ðŸ“± ì•±ì„ ì—´ì§€ ì•Šê³  í•™ìŠµí•˜ëŠ” í™ˆ í™”ë©´ ìœ„ì ¯",
            feature4: "âš¡ ì‹œí—˜ ëŒ€ë¹„ë¥¼ ìœ„í•œ ìŠ¤í”¼ë“œ ëª¨ë“œ",
            feature5: "ðŸ“– ë¬¸ë§¥ìœ¼ë¡œ í•™ìŠµí•˜ëŠ” ì˜ˆë¬¸ ê¸°ëŠ¥"
        },
        age: {
            name: "ë§Œë‚˜ì´ ê³„ì‚°ê¸°",
            tagline: "ì •í™•í•œ ë‚˜ì´ ê³„ì‚°ì„ ì†ì‰½ê²Œ",
            description: "í•œêµ­ ë‚˜ì´ì™€ ë§Œ ë‚˜ì´ê°€ í—·ê°ˆë¦¬ì‹œë‚˜ìš”? ìƒì¼ ì¶”ì ê³¼ ë³„ìžë¦¬ ì •ë³´ë¡œ ì¦‰ì‹œ ê³„ì‚°.",
            feature1: "ðŸŽ¯ ë‹¤ì–‘í•œ ë‚˜ì´ í˜•ì‹: ë§Œ ë‚˜ì´, í•œêµ­ ë‚˜ì´, ì—° ë‚˜ì´",
            feature2: "ðŸ“Š ìƒì„¸í•œ ì¸ìƒ í†µê³„: ì¼ìˆ˜, ì£¼, ê°œì›”, ì‹œê°„, ì´ˆ",
            feature3: "ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦ ê°€ì¡±ê³¼ ì¹œêµ¬ì˜ ìƒì¼ ê´€ë¦¬",
            feature4: "â­ ìƒì„¸ ì •ë³´ê°€ í¬í•¨ëœ ë³„ìžë¦¬ ìžë™ íŒì •",
            feature5: "ðŸ”® ë³„ìžë¦¬ ê¸°ë°˜ ë§¤ì¼ì˜ ìš´ì„¸"
        },
        features: {
            title: "ì£¼ìš” ê¸°ëŠ¥"
        },
        download: {
            android: "Google Play",
            ios: "App Store"
        }
    }
};

// ===== Language Detection & Management =====
let currentLang = 'en';

function detectBrowserLanguage() {
    const browserLang = navigator.language || navigator.userLanguage;
    
    if (browserLang.startsWith('ja')) {
        return 'ja';
    } else if (browserLang.startsWith('ko')) {
        return 'ko';
    } else {
        return 'en';
    }
}

function setLanguage(lang) {
    currentLang = lang;
    
    // Update all text elements
    document.querySelectorAll('[data-i18n]').forEach(element => {
        const keys = element.getAttribute('data-i18n').split('.');
        let translation = translations[lang];
        
        for (const key of keys) {
            translation = translation[key];
        }
        
        if (translation) {
            element.textContent = translation;
        }
    });
    
    // Update active language button
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.getAttribute('data-lang') === lang) {
            btn.classList.add('active');
        }
    });
    
    // Save language preference
    localStorage.setItem('preferredLanguage', lang);
    
    // Update page title
    const titles = {
        en: 'CD Labs - Quality Apps for Everyone',
        ja: 'CD Labs - ã¿ã‚“ãªã®ãŸã‚ã®é«˜å“è³ªã‚¢ãƒ—ãƒª',
        ko: 'CD Labs - ëª¨ë‘ë¥¼ ìœ„í•œ ê³ í’ˆì§ˆ ì•±'
    };
    document.title = titles[lang];
}

// Update screenshots based on selected language
function updateScreenshots(lang) {
    document.querySelectorAll('.app-screenshots').forEach(screenshotContainer => {
        const appName = screenshotContainer.getAttribute('data-app');
        const images = screenshotContainer.querySelectorAll('img[data-lang-img]');
        
        images.forEach(img => {
            const screenshotType = img.getAttribute('data-lang-img');
            // Language-specific path: images/[lang]/[app]-[screenshot].png
            // Example: images/ja/raku-jlpt-screenshot1.png
            const langPath = `images/${lang}/${appName}-${screenshotType}.png`;
            
            img.src = langPath;
            img.style.display = 'block'; // Show image (will be hidden by onerror if not found)
        });
    });
}

// ===== Platform Detection =====
function detectPlatform() {
    const userAgent = navigator.userAgent || navigator.vendor || window.opera;
    
    // iOS detection
    if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
        return 'ios';
    }
    
    // Android detection
    if (/android/i.test(userAgent)) {
        return 'android';
    }
    
    return 'other';
}

function updateDownloadButtons() {
    const platform = detectPlatform();
    const googlePlayButtons = document.querySelectorAll('.google-play');
    const appStoreButtons = document.querySelectorAll('.app-store');
    
    // On mobile, prioritize the appropriate store
    if (platform === 'ios') {
        // Move App Store buttons to the left (first position)
        googlePlayButtons.forEach(btn => {
            btn.style.order = '2';
        });
        appStoreButtons.forEach(btn => {
            btn.style.order = '1';
        });
    } else if (platform === 'android') {
        // Keep Google Play buttons on the left (default)
        googlePlayButtons.forEach(btn => {
            btn.style.order = '1';
        });
        appStoreButtons.forEach(btn => {
            btn.style.order = '2';
        });
    }
}

// ===== Smooth Scroll Animation =====
function initScrollAnimations() {
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };
    
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, observerOptions);
    
    document.querySelectorAll('.app-card').forEach(card => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(30px)';
        card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
        observer.observe(card);
    });
}

// ===== Analytics (Optional) =====
function trackDownloadClick(appName, platform) {
    // Add your analytics tracking here
    console.log(`Download clicked: ${appName} on ${platform}`);
}

// ===== Initialize =====
document.addEventListener('DOMContentLoaded', () => {
    // Initialize theme
    initializeTheme();
    
    // Set initial language
    const savedLang = localStorage.getItem('preferredLanguage');
    const initialLang = savedLang || detectBrowserLanguage();
    setLanguage(initialLang);
    
    // Update download buttons based on platform
    updateDownloadButtons();
    
    // Initialize scroll animations
    initScrollAnimations();
    
    // Initialize smooth scroll for app navigation
    initAppNavigation();
    
    // Check for hash in URL and scroll to it
    if (window.location.hash) {
        setTimeout(() => {
            scrollToApp(window.location.hash.substring(1));
        }, 100);
    }
    
    // Language button event listeners
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const lang = btn.getAttribute('data-lang');
            setLanguage(lang);
        });
    });
    
    // Theme toggle event listener
    const themeToggle = document.getElementById('themeToggle');
    if (themeToggle) {
        themeToggle.addEventListener('click', toggleTheme);
    }
    
    // Share page button
    const sharePageBtn = document.getElementById('sharePageBtn');
    if (sharePageBtn) {
        sharePageBtn.addEventListener('click', () => sharePage());
    }
    
    // App share buttons
    document.querySelectorAll('.app-share-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const appId = btn.getAttribute('data-app');
            shareApp(appId);
        });
    });
    
    // Track download button clicks
    document.querySelectorAll('.download-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const appCard = btn.closest('.app-card');
            const appName = appCard.id;
            const platform = btn.classList.contains('google-play') ? 'Android' : 'iOS';
            trackDownloadClick(appName, platform);
        });
    });
});

// ===== App Navigation & Smooth Scroll =====
function initAppNavigation() {
    const navItems = document.querySelectorAll('.app-nav-item');
    
    navItems.forEach(item => {
        item.addEventListener('click', (e) => {
            e.preventDefault();
            const targetId = item.getAttribute('href').substring(1);
            scrollToApp(targetId);
            
            // Update URL without page reload
            history.pushState(null, null, `#${targetId}`);
        });
    });
}

function scrollToApp(appId) {
    const targetElement = document.getElementById(appId);
    if (targetElement) {
        const offset = 100; // Offset for fixed header
        const targetPosition = targetElement.offsetTop - offset;
        
        window.scrollTo({
            top: targetPosition,
            behavior: 'smooth'
        });
        
        // Highlight animation
        targetElement.style.transform = 'scale(1.02)';
        setTimeout(() => {
            targetElement.style.transform = 'scale(1)';
        }, 300);
    }
}

// ===== Theme Management =====
function initializeTheme() {
    const html = document.documentElement;
    const savedTheme = localStorage.getItem('theme');
    const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    
    if (savedTheme) {
        html.setAttribute('data-theme', savedTheme);
        updateThemeIcon(savedTheme);
    } else if (systemDark) {
        html.setAttribute('data-theme', 'dark');
        updateThemeIcon('dark');
    } else {
        updateThemeIcon('light');
    }
}

function toggleTheme() {
    const html = document.documentElement;
    const currentTheme = html.getAttribute('data-theme');
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    
    html.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
    updateThemeIcon(newTheme);
}

function updateThemeIcon(theme) {
    const themeIcon = document.getElementById('themeIcon');
    if (themeIcon) {
        themeIcon.textContent = theme === 'dark' ? 'â˜€ï¸' : 'ðŸŒ™';
    }
}

// ===== Share Functions =====
async function sharePage() {
    const shareData = {
        title: 'CleanDino - Quality Apps',
        text: 'Check out CleanDino apps - JLPT study and Age Calculator',
        url: window.location.href.split('#')[0]
    };
    
    await shareContent(shareData);
}

async function shareApp(appId) {
    const appData = {
        'raku-jlpt': {
            title: 'Raku JLPT Vocabulary',
            text: 'Master JLPT with smart review and proven results',
            url: `${window.location.href.split('#')[0]}#raku-jlpt`
        },
        'age-calculator': {
            title: 'Age Calculator',
            text: 'Calculate Korean age vs international age instantly',
            url: `${window.location.href.split('#')[0]}#age-calculator`
        }
    };
    
    const shareData = appData[appId];
    if (shareData) {
        await shareContent(shareData);
    }
}

async function shareContent(shareData) {
    // Try native share API (mobile)
    if (navigator.share) {
        try {
            await navigator.share(shareData);
        } catch (err) {
            if (err.name !== 'AbortError') {
                copyToClipboard(shareData.url);
            }
        }
    } else {
        // Fallback: copy to clipboard (desktop)
        copyToClipboard(shareData.url);
    }
}

function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => {
        showToast('Link copied to clipboard!');
    }).catch(() => {
        showToast('Failed to copy link');
    });
}

function showToast(message) {
    const toast = document.createElement('div');
    toast.className = 'toast';
    toast.textContent = message;
    document.body.appendChild(toast);
    
    setTimeout(() => toast.classList.add('show'), 10);
    setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300);
    }, 2000);
}

// ===== Dark Mode Toggle (Optional Enhancement) =====
function initDarkModeToggle() {
    const darkModeMediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
    
    darkModeMediaQuery.addEventListener('change', (e) => {
        // Automatically apply dark mode when system preference changes
        document.body.classList.toggle('dark-mode', e.matches);
    });
}

// Uncomment to enable dark mode toggle
// initDarkModeToggle();

// ===== Service Worker (for PWA - Optional) =====
if ('serviceWorker' in navigator) {
    // Uncomment to enable PWA features
    // navigator.serviceWorker.register('/sw.js');
}
